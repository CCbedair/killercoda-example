#!/bin/bash

# Apply DIND deployment https://github.com/madhuakula/kubernetes-goat/blob/master/access-kubernetes-goat.sh#L22
git clone https://github.com/madhuakula/kubernetes-goat.git
kubectl apply -f kubernetes-goat/scenarios/hunger-check/deployment.yaml

sleep 15

# Exposing the port
POD_NAME=$(kubectl get pods --all-namespaces -l "app=hunger-check" -o jsonpath="{.items[0].metadata.name}")
kubectl port-forward $POD_NAME --address 0.0.0.0 1231:3000 > /dev/null 2>&1 &

echo done > /tmp/background0